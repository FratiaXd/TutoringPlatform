@page "/coursepages/learning/{CourseId:int}"
@using TutoringPlatform.Client.CoursePages.Shared
@rendermode InteractiveAuto
@inherits LayoutComponentBase

<div>
    <h2>CourseLearning</h2>
    <hr />
    <div class="row">
        <div class="col-md-3">
            <LearningSidebar CourseId="@CourseId" CurUserId="@CurUserId"
                OnLessonClicked="HandleLessonClicked"
                OnQuizClicked="HandleQuizClicked"
                OnAssignmentClicked="HandleAssignmentClicked" />
        </div>
        <div class="col-md-9">
            @if (selectedLesson != null)
            {
                <LessonContent Lesson="@selectedLesson" CurUserId="@CurUserId" />
            }
            else if (selectedQuiz != null)
            {
                <QuizContent Quiz="@selectedQuiz" CurUserId="@CurUserId" />
            }
            else if (selectedAssignment != null)
            {
                <AssignmentContent Assignment="@selectedAssignment" CurUserId="@CurUserId" />
            }
        </div>
    </div>
</div>


@code {
    [Parameter]
    public int CourseId { get; set; }
    private string CurUserId { get; set; }
    private Lesson selectedLesson;
    private Quiz selectedQuiz;
    private Assignment selectedAssignment;

    private async Task HandleLessonClicked(Lesson lesson)
    {
        selectedLesson = lesson;
        selectedQuiz = null; // Reset other selections
        selectedAssignment = null;
    }

    private async Task HandleQuizClicked(Quiz quiz)
    {
        selectedLesson = null; // Reset other selections
        selectedQuiz = quiz;
        selectedAssignment = null;
    }

    private async Task HandleAssignmentClicked(Assignment assignment)
    {
        selectedLesson = null; // Reset other selections
        selectedQuiz = null;
        selectedAssignment = assignment;
    }

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        CurUserId = user.FindFirstValue(ClaimTypes.NameIdentifier);
    }
}
